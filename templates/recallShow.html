<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>recall召回服务</title>
<link rel="stylesheet" href="{{ url_for('static', filename='layui/css/layui.css') }}">
<script type="text/javascript" src="{{url_for('static', filename='js/jquery-3.3.1.min.js')}}"></script>
</head>
<body>
    <hr class="layui-border-black">
    <form class="layui-form layui-form-pane" action="/recallServer" method="get">
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">用户ID</label>
                <div class="layui-input-inline" style="width: 200px;">
                    {% if uid==0 %} 
                        <input type="text"  name="ToSearchUid" required lay-verify="required" placeholder="请输入用户id(1-1373351)" autocomplete="off" class="layui-input">
                    {% else %}
                        <input type="text"  value={{uid}}  name="ToSearchUid" required lay-verify="required" placeholder="请输入用户id(1-1373351)" autocomplete="off" class="layui-input">
                    {% endif %}
                </div>
                <div class="layui-input-inline" style="width: 100px;">
                    <button type="submit" id="ok" lay-filter="formDemo" class="layui-btn layui-btn-radius layui-btn-normal"><i class="layui-icon layui-icon-search">&nbsp;&nbsp;</i><cite>提交</cite></button>
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">响应时间</label>
                <div class="layui-input-inline" style="width: 100px;">
                    <input type="text" value={{costTime}} readonly placeholder="0" autocomplete="off" class="layui-input">
                </div>
                <div class="layui-form-mid">秒</div>
            </div>
        </div>        
    </form>   
	<hr class="layui-border-black">
	<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
        <legend>候选集商品ID表</legend>
	</fieldset>
    <table class="layui-hide" id="Info"></table>
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
        <legend>源信息</legend>
	</fieldset>
        <fieldset class="layui-elem-field layui-field-title">
                <span class="layui-badge layui-bg-blue">recallService</span>
                {% if originData==0 %}
                    <div class="layui-field-box">
                        这里展示的是服务器端传来的原始数据
                    </div>
                {% else %}
                    <div class="layui-field-box">
                        {{originData}}
                    </div>
                {% endif %}
        </fieldset>
    <input type="text" id="code" value={{stateCode}} hidden>

</body>
</html>
<script src="{{ url_for('static', filename = 'layui/layui.js') }}" charset="utf-8"></script>
<script type="text/javascript">
layui.use('layer', function(){
    var layer = layui.layer;
    $("#ok").on("click",function(){
        var index = layer.load(1, {shade: false});
    })
    $(document).ready(function(){
        //通过状态码提示用户是否查询成功
        var code=$("#code").val()
        if(code==200){
            layer.msg('召回成功!', {icon: 1,time:1500});
        }
        if(code==500){
            layer.msg('召回失败,请更换id后尝试!', {icon: 2,time:1500});
        }
    }); 
}); 

layui.use('form', function(){
    var form = layui.form;

  //监听提交
    form.on('submit(formDemo)', function(data){
        layer.msg(JSON.stringify(data.field));
        return false;
    });
});
layui.use('table', function(){
    var table = layui.table;
    //直接在js中获取flask后台传过来的值，不建议这样做有js注入风险
    var tablevalue={{result|tojson}};
    //展示已知数据
    table.render({
        elem: '#Info'
        ,title:'候选集商品ID列表'
        ,cols: [[ //标题栏
            {type: 'checkbox', fixed: 'left'}
            ,{field: 'nid', title: '商品ID', align: 'center'}
            ,{field: 'score', title: '向量欧式距离(相似度得分)',sort:true, align: 'center'}
        ]]
        ,toolbar:true
        ,defaultToolbar: ['filter', 'exports', 'print']
        ,data: tablevalue
        ,skin: 'line' //表格风格
        ,even: true
        ,page: true //是否显示分页
        //,limits: [5, 7, 10]
        ,limit: 10 //每页默认显示的数量
    });
});
</script>

